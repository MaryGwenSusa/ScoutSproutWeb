<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spider Plant Monitoring Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
    }
    html {
      scroll-padding-top: 80px; 
      scroll-behavior: smooth;
    }
    img {
      width: 100%;
    }
    body {
      background: url('images/web_bg.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #e6f4e6; /* light desaturated green-white */
      font-family: 'Segoe UI', sans-serif;
      position: relative;
    }
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(1, 26, 1, 0.568); /* dark green matte overlay */
      z-index: -1;
    }
    header {
      background: transparent;
      position: fixed;
      width: 100%;
      z-index: 10;
    }
    .no-hover:hover{
      text-decoration: none;
    }
    footer {
      background-color: #198754;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.07); /* semi-transparent white */
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: none;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      color: #e0f2e0;
      height: 160px; /* Set your desired fixed height */
    }
    .glass-card h2 {
      font-size: 2.5rem; /* Make sensor readings bigger */
      margin-bottom: 3rem; /* Add space below reading */
      color: #D8E9A8;
    }
    .score-box {
      margin-top: -0.3em;
      font-size: 2.2rem;
      font-weight: bold;
      color: #BEF992;
      width: 10em;
    }
    #pagination {
      margin-top: 10px;
      user-select: none;
    }
    #pagination button {
      margin: 0 5px;      
    }
    .matte-text {
      color: rgba(255, 255, 255, 0.85); /* soft white */
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); /* slight shadow for contrast */
      font-weight: 600;
      filter: brightness(1); /* slightly dims for a matte feel */
    }
    .matte-sub-head{
        color: rgba(255, 255, 255, 0.85); /* soft white */
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); /* slight shadow for contrast */
        filter: brightness(1); /* slightly dims for a matte feel */
    }
    .glass-badge {
      font-size: 0.75rem;
      padding: 0.3em 0.75em;
      border-radius: 12px;
      backdrop-filter: blur(4px);
      background: rgba(255, 255, 255, 0.15);
      color: white;
    }
    .status-ideal {
      background: rgba(0, 200, 83, 0.25); /* soft green */
    }
    .status-fair {
      background: rgba(255, 193, 7, 0.25); /* soft yellow */
    }
    .status-poor {
      background: rgba(244, 67, 54, 0.25); /* soft red */
    }
    .tooltip-inner {
      background: #a27b5ca0;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: white;
      border-radius: 12px;
      /* border: 1px solid rgba(255, 255, 255, 0.2); */
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      font-size: 0.9rem;
      padding: 8px 12px;
    }
    .tooltip.bs-tooltip-auto[x-placement^="top"] .arrow::before,
    .tooltip.bs-tooltip-top .arrow::before {
      border-top-color: rgba(255, 255, 255, 0.15);
    }
    @keyframes wiggle {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(3deg); }
      50% { transform: rotate(-3deg); }
      75% { transform: rotate(3deg); }
      100% { transform: rotate(0deg); }
    }
    .plant-icon:hover {
      animation: wiggle 0.4s ease-in-out;
    }

  </style>
</head>
<body>
<header>
 <nav class="navbar navbar-expand-lg navbar-light px-4 py-2" style="background-color: rgba(61, 100, 77, 0); ;">
    <a class="navbar-brand fw-bold fs-5 text-white no-hover" href="index.html">ðŸŒ± Sprout Scout</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-white" href="#metrics">Plant Status</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="#readings">Live Sensor Readings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="#trends">Sensor Trends</a>
        </li>
      </ul>
    </div>
  </nav>
</header>

  <div class="container py-4">
    <h2 class="text-center mb-4 mt-5 display-5 matte-text">
      Spider Plant Monitoring Dashboard
    </h2>

    <!-- Calculated Values FIRST -->
    <h4 class="mt-4 mb-3 matte-sub-head" id="metrics">Plant Status</h4>
    <div class="row mt-4">
      <div class="col-md-4 ">
        <div class="card shadow glass-card">
        <div class="card-body ">
          <h5 class="d-flex justify-content-between align-items-center">
            <span>Plant Stress</span>
            <span tabindex="0" data-bs-toggle="tooltip" title="Shows environmental stress signals" style="cursor: pointer;">
              <img src="https://img.icons8.com/glassmorphism/48/open-book.png" alt="Info" style="width: 1.7em; height: 1.7em; vertical-align: text-bottom;" />
            </span>

          </h5>
          <p id="stress">Analyzing...</p>
        </div>
      </div>
    </div>
      <div class="col-md-4">
          <div class="card shadow glass-card">
            <div class="card-body">
              <h5 class="d-flex justify-content-between align-items-center">
              <span>Health Index Score</span>
              <span tabindex="0" data-bs-toggle="tooltip" title="Overall condition score (0â€“100)" style="cursor: pointer; ">
                <img src="https://img.icons8.com/glassmorphism/48/open-book.png" alt="Info" style="width: 1.7em; height: 1.7em; vertical-align: text-bottom;" />
              </span>
              </h5>
              <div class="score-box" id="healthIndex">--</div>
            </div>
          </div>
      </div>
    </div>

    <!-- Live Sensor Metrics AFTER -->
    <h4 class="mt-5 mb-3 matte-sub-head" id="readings">Live Sensor Readings</h4>
    <div class="row text-center mt-4">
      <div class="col-md-3">
        <div class="card shadow glass-card">
        <div class="card-body ">
          <h5 class="d-flex justify-content-between align-items-center">
            <span>Soil Moisture
              <span id="status-moisture" class="glass-badge status-poor ms-2">Poor</span>
            </span>
            <span tabindex="0" data-bs-toggle="tooltip" title="Ideal range: 50â€“75%" style="cursor: pointer; ">
              <img src="https://img.icons8.com/glassmorphism/48/open-book.png" alt="Info" style="width: 1.7em; height: 1.7em; vertical-align: text-bottom;" />
            </span>
          </h5>
        </div>
        <h2 id="moisture">--%</h2>
        </div>
      </div>
    <div class="col-md-3">
      <div class="card shadow glass-card">
          <div class="card-body ">
            <h5 class="d-flex justify-content-between align-items-center">
              <span>Light Level
                 <span id="status-light" class="badge ms-2 bg-secondary">--</span>
              </span>
              <span tabindex="0" data-bs-toggle="tooltip" title="Light intensity in lux (ideal: 600â€“900)" style="cursor: pointer; ">
                <img src="https://img.icons8.com/glassmorphism/48/open-book.png" alt="Info" style="width: 1.7em; height: 1.7em; vertical-align: text-bottom;" />
              </span>
            </h5>
          </div>
        <h2 id="light">-- lux</h2>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow glass-card">
          <div class="card-body ">
            <h5 class="d-flex justify-content-between align-items-center">
              <span>Temperature
                 <span id="status-temp" class="badge ms-2 bg-secondary">--</span>
              </span>
              <span tabindex="0" data-bs-toggle="tooltip" title="Ideal temp: 22â€“30Â°C" style="cursor: pointer; ">
                <img src="https://img.icons8.com/glassmorphism/48/open-book.png" alt="Info" style="width: 1.7em; height: 1.7em; vertical-align: text-bottom;" />
              </span>
            </h5>
          </div>
      <h2 id="temp">--Â°C</h2>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow glass-card">
          <div class="card-body ">
            <h5 class="d-flex justify-content-between align-items-center">
              <span>Humidity
                 <span id="status-humidity" class="badge ms-2 bg-secondary">--</span>
              </span>
              <span tabindex="0" data-bs-toggle="tooltip" title="Humidity comfort zone: 60â€“80%" style="cursor: pointer; ">
                <img src="https://img.icons8.com/glassmorphism/48/open-book.png" alt="Info" style="width: 1.7em; height: 1.7em; vertical-align: text-bottom;" />
              </span>
            </h5>
          </div>
      <h2 id="humidity">--%</h2>
      </div>
    </div>
    </div>
  </div>

  <!-- Sensor Trend Chart -->
  <div class="card shadow mt-4">
    <div class="card-body">
      <h5 class="card-title" id="trends">Sensor Trends</h5>
      <canvas id="sensorChart" height="100"></canvas>
    </div>
  </div>

  <!-- Collapsible Historical Data Table -->
  <div class="accordion mt-4" id="dataAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTable">
            Last Sensor Data Records
          </button>
        </h2>
        <div id="collapseTable" class="accordion-collapse collapse" data-bs-parent="#dataAccordion">
          <div class="accordion-body">
            <div class="table-responsive">
              <table class="table table-striped table-bordered" id="dataTable">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Temp (Â°C)</th>
                    <th>Humidity (%)</th>
                    <th>Light (lux)</th>
                    <th>Moisture (%)</th>
                    <th>Plant Stress</th>
                    <th>Health Index</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div id="pagination" class="text-center">
              <button id="prevPage" class="btn btn-sm btn-primary" disabled>Previous</button>
              <span id="pageInfo"></span>
              <button id="nextPage" class="btn btn-sm btn-primary" disabled>Next</button>
            </div>
          </div>
        </div>
      </div>
  </div>
  </div>

  <footer>
    <p class="text-center text-white fw-bold mb-0 py-2">&copy; Sprout Scout 2025. All Rights Reserved.</p>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipList = tooltipTriggerList.map(el => new bootstrap.Tooltip(el));
    const tempEl = document.getElementById("temp");
    const humidityEl = document.getElementById("humidity");
    const lightEl = document.getElementById("light");
    const moistureEl = document.getElementById("moisture");
    const stressEl = document.getElementById("stress");
    const healthIndexEl = document.getElementById("healthIndex");
    const dataTableBody = document.querySelector("#dataTable tbody");
    const prevPageBtn = document.getElementById("prevPage");
    const nextPageBtn = document.getElementById("nextPage");
    const pageInfo = document.getElementById("pageInfo");
    const lowScoreIcon = 'images/unhealthy_plant.png';     // e.g. for 0 or 25
    const highScoreIcon = 'images/healthy_plant.png';  // e.g. for 75 or 100

    let daysSincePlanting = null; // fallback default
    const pageSize = 10;
    let currentPage = 1;
    let allData = [];

    function getSensorData() {
      return {
        temp: 15 + Math.random() * 25,           // 15 to 40 Â°C
        humidity: 30 + Math.random() * 60,       // 30 to 90%
        light: 200 + Math.random() * 800,        // 200 to 1000 lux
        moisture: 20 + Math.random() * 80,       // 20 to 100%
        time: new Date().toLocaleTimeString(),
      };
    }

    function calculateForecast(data) {
      const stress = [];
      if (data.temp > 32)
        stress.push(`<img src="https://img.icons8.com/glassmorphism/48/hot.png" style="height: 1.7em; width: 2em; vertical-align: text-bottom; display: inline; alt=High Temp"/> High Temp`);
      if (data.temp < 20)
        stress.push(`<img src="https://img.icons8.com/glassmorphism/48/cold.png" style="height: 1.7em; width: 2em; vertical-align: text-bottom; display: inline; alt=Low Temp"/> Low Temp`);
      if (data.moisture < 40)
        stress.push(`<img src="https://img.icons8.com/glassmorphism/48/ground.png" style="height: 1.7em; width: 2em; vertical-align: text-bottom; display: inline; alt=Dry Soil"/> Dry Soil`);
      if (data.moisture > 80)
        stress.push(`<img src="https://img.icons8.com/glassmorphism/48/soil.png" style="height: 1.7em; width: 2em; vertical-align: text-bottom; display: inline; alt=Overwatering"/> Overwatering`);
      if (data.light < 500)
        stress.push(`<img src="https://img.icons8.com/glassmorphism/48/clouds.png" style="height: 1.7em; width: 2em; vertical-align: text-bottom; display: inline; alt=Low Light"/> Low Light`);

      const stressText = stress.length
        ? stress.join("<br>")
        : `<em>No visible stress</em>`;

      const tempScore = data.temp >= 22 && data.temp <= 30 ? 1 : 0;
      const humidityScore = data.humidity >= 60 && data.humidity <= 80 ? 1 : 0;
      const moistureScore = data.moisture >= 50 && data.moisture <= 75 ? 1 : 0;
      const lightScore = data.light >= 600 && data.light <= 900 ? 1 : 0;
      const healthIndex = ((tempScore + humidityScore + moistureScore + lightScore) / 4) * 100;

      return {
        stressText,
        healthIndex: healthIndex.toFixed(0),
      };
    }

    function setStatus(el, value, goodRange) {
      const badge = document.getElementById(el);
      badge.className = "glass-badge ms-2"; // reset

      if (value >= goodRange.min && value <= goodRange.max) {
        badge.textContent = "Ideal";
        badge.classList.add("status-ideal");
      } else if (
        value >= goodRange.min - 10 &&
        value <= goodRange.max + 10
      ) {
        badge.textContent = "Fair";
        badge.classList.add("status-fair");
      } else {
        badge.textContent = "Poor";
        badge.classList.add("status-poor");
      }
    }

    const ctx = document.getElementById("sensorChart").getContext("2d");
    const chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [
          { label: "Temp (Â°C)", data: [], borderColor: "#ff6384", fill: false },
          { label: "Humidity (%)", data: [], borderColor: "#36a2eb", fill: false },
          { label: "Light (lux)", data: [], borderColor: "#fbc02d", fill: false },
          { label: "Moisture (%)", data: [], borderColor: "#4caf50", fill: false },
        ],
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } },
      },
    });

    function updateTablePage() {
      const totalPages = Math.ceil(allData.length / pageSize) || 1;
      currentPage = Math.min(Math.max(1, currentPage), totalPages);
      const startIdx = (currentPage - 1) * pageSize;
      const endIdx = startIdx + pageSize;
      const pageData = allData.slice(startIdx, endIdx);

      dataTableBody.innerHTML = "";
      pageData.forEach((entry) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${entry.time}</td>
          <td>${entry.temp.toFixed(1)}</td>
          <td>${entry.humidity.toFixed(1)}</td>
          <td>${entry.light.toFixed(0)}</td>
          <td>${entry.moisture.toFixed(0)}</td>
          <td>${entry.stressText}</td>
          <td>${entry.healthIndex}</td>
        `;
        dataTableBody.appendChild(row);
      });

      pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
      prevPageBtn.disabled = currentPage === 1;
      nextPageBtn.disabled = currentPage === totalPages;
    }

    prevPageBtn.addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        updateTablePage();
      }
    });

    nextPageBtn.addEventListener("click", () => {
      const totalPages = Math.ceil(allData.length / pageSize);
      if (currentPage < totalPages) {
        currentPage++;
        updateTablePage();
      }
    });

    function updateDashboard() {
      const data = getSensorData();
      const calculated = calculateForecast(data);

      // Update UI
      tempEl.textContent = `${data.temp.toFixed(1)}Â°C`;
      humidityEl.textContent = `${data.humidity.toFixed(1)}%`;
      lightEl.textContent = `${data.light.toFixed(0)} lux`;
      moistureEl.textContent = `${data.moisture.toFixed(0)}%`;
      stressEl.innerHTML = calculated.stressText;

      // Determine icon based on score
      const score = parseInt(calculated.healthIndex);
      let iconUrl;
      if (score === 0 || score === 25 || score === 50) {
        iconUrl = lowScoreIcon;
      } else if (score === 75 || score === 100) {
        iconUrl = highScoreIcon;
      } else {
        iconUrl = '';
      }

      healthIndexEl.innerHTML = `
        <div class="d-flex justify-content-between align-items-center">
          <span>${score} / 100</span>
          ${iconUrl
            ? `<img src="${iconUrl}" alt="score icon" class="plant-icon" style="height:3em; width:2.7em; margin-left:2.8em; margin-top:-0.2em;" />`
            : ''
          }
        </div>
      `;

      setStatus("status-moisture", data.moisture, { min: 50, max: 75 });
      setStatus("status-light", data.light, { min: 600, max: 900 });
      setStatus("status-temp", data.temp, { min: 22, max: 30 });
      setStatus("status-humidity", data.humidity, { min: 60, max: 80 });

      // Store & chart
      allData.push({
        time: data.time,
        ...data,
        ...calculated,
      });

      chart.data.labels.push(data.time);
      chart.data.datasets[0].data.push(data.temp);
      chart.data.datasets[1].data.push(data.humidity);
      chart.data.datasets[2].data.push(data.light);
      chart.data.datasets[3].data.push(data.moisture);

      if (chart.data.labels.length > 10) {
        chart.data.labels.shift();
        chart.data.datasets.forEach((ds) => ds.data.shift());
      }

      chart.update();

      // Update table
      currentPage = Math.ceil(allData.length / pageSize);
      updateTablePage();
    }

    // Initial setup
    setInterval(updateDashboard, 5000);
    updateDashboard();

    document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach((el) => new bootstrap.Tooltip(el));
</script>
</body>
</html>
